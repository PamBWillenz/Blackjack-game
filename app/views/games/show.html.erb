<div id="game-container" class="game-container">
  <h1 class="game-heading">Blackjack Game</h1>
  <p id="game-id" class="game-id">Game ID: <%= @game.id %></p>

  <div id="betting-section" class="mb-8">
    <h2 id="betting-title" class="betting-title">Place Your Bet</h2>
    <% player = @game.player %>
    <div class="player-bet-container">
      <span class="player-name-label"><%= player&.name || 'Player' %></span>
      <%= turbo_frame_tag dom_id(player || @game, :bet) do %>
      <%= render partial: 'players/player_bet', locals: { player: player } %>
      <% end %>
    </div>
    <%# Show Deal Cards button when the game has no cards (start the round).
        The button is visible so users can start the round, but it's disabled until
        every non-dealer player has placed a bet. %>
    <% if @game.cards.empty? %>
    <%= turbo_frame_tag dom_id(@game, :deal_button) do %>
    <%= render partial: 'games/deal_button', locals: { game: @game } %>
    <% end %>
    <% end %>

    <%# Show New Game button only when the round is over %>
    <% if @game.game_over? %>
    <div class="new-game-btn-container">
      <%= button_to "New Game", new_game_path, method: :get, class: "btn-deal btn-new" %>
    </div>
    <% end %>
  </div>

  <% if @game.cards.any? %>
  <%# Single-player rendering: show player then dealer %>
  <% player = @game.player %>
  <% dealer_player = @game.dealer %>
  <% ordered = [player, dealer_player].compact %>
  <% ordered.each do |player| %>
  <div class="player-card">
    <h2 class="player-name"><%= player.is_dealer ? "Dealer" : player.name %></h2>
    <div class="player-cards-container">
      <% player.cards.each do |card| %>
      <% if player.is_dealer && !card.face_up %>
      <div class="card-back">
        <span>ðŸ‚ </span>
      </div>
      <% else %>
      <div class="card-front">
        <span class="card-rank"><%= card.rank %></span>
        <span class="card-suit <%= suit_color_class(card.suit) %>">
          <%= suit_symbol(card.suit) %>
        </span>
      </div>
      <% end %>
      <% end %>
    </div>

    <% if player.is_dealer %>
    <%# Show only visible dealer hand value until player is done %>
    <% if @game.player_done? %>
    <p class="hand-value">Hand Value: <span class="hand-value-number"><%= player.hand_value %></span></p>
    <% if @game.game_over? %>
    <% if @game.dealer_winner? %>
    <span class="winner-badge">Winner!</span>
    <% elsif @game.bust?(player) %>
    <span class="bust">Bust!</span>
    <% end %>
    <% end %>
    <% else %>
    <p class="hand-value">Hand Value: <span class="hand-value-number"><%= player.visible_hand_value %></span> (visible)</p>
    <% end %>
    <% else %>
    <p class="hand-value">Hand Value: <span class="hand-value-number"><%= player.hand_value %></span></p>
    <% if @game.game_over? && (player.standing || @game.bust?(player)) %>
    <% if @game.winner?(player) %>
    <span class="winner-badge">Winner!</span>
    <% elsif @game.tie?(player) %>
    <span class="tie-badge">Tie!</span>
    <% elsif @game.bust?(player) %>
    <span class="bust">Bust!</span>
    <% end %>
    <% end %>
    <% end %>

    <div class="player-action-btns">
      <% if !player.is_dealer && !player.standing %>
      <%= button_to "Hit", hit_game_path(@game, player_id: player.id), method: :post, class: "btn-action btn-hit" %>
      <%= button_to "Stand", stand_game_path(@game, player_id: player.id), method: :post, class: "btn-action btn-stand" %>
      <% else %>
      &nbsp;
      <% end %>
    </div>
  </div>
  <% end %>
  <% end %>